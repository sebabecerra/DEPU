---
title: "Índice de Incertdumbre Económica y Política para Chile basado en Twitter∗"
author:
  - Sebastian Becerra^[Central Bank of Chile, seba.becerra@gmail.com]
  - Andrés Sagner^[Central Bank of Chile, asagner@bcentral.cl]

date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document: default
  pdf_document: default
---



```{r include=FALSE}
#instalamos los paquetes si hace falta
if(!require("tidyverse")) install.packages("tidyverse")
if(!require("fs")) install.packages("fs")
if(!require("readxl")) install.packages("readxl")


#paquetes
library(plotly)
library(tidyverse)
library(fs)
library(readxl)
```

<font size="3" color="black"><p style="text-align:justify;">
En este artículo, desarrollamos una medida de incertidumbre económica en frecuencia diaria para Chile utilizando información obtenida desde cuentas de Twitter mediante técnicas de web scraping, y siguiendo de cerca la metodología propuesta por Baker et al. (2016). Las medidas propuestas, denominadas DEPU y DEPUC, apuntan a capturar el nivel de desacuerdo general en los contenidos de tweets –una proxy de incertidumbre económica– en tópicos relacionados con la economía, políticas económicas, incertidumbre acerca de eventos particulares, y la contingencia económica en Chile. Ambas medidas, disponibles desde 2012, muestran aumentos significativos que coinciden con varios episodios locales e internacionales que provocaron niveles extraordinarios de incertidumbre económica en Chile, especialmente luego de los eventos en torno a las protestas civiles de mediados de Octubre 2019 y la pandemia del COVID-19 a mediados de Marzo 2020. Los resultados de un ejercicio empírico revelan que la medida propuesta es un determinante significativo de la dinámica del tipo de cambio nominal, especialmente cuando la magnitud de esta variable es elevada y luego de una semana de ocurrido un shock de incertidumbre. Por el contrario, cuando el tipo de cambio se encuentra en niveles bajos, los impactos de la incertidumbre sobre esta variable son cuantitativamente menores para cualquier horizonte de proyección. Estas características, y otras discutidas en el artículo, destacan la utilidad de la métrica propuesta como un indicador adicional que los encargados de formular políticas pueden incorporar en su set de herramientas de monitoreo. 
</p></font>


[Data](https://drive.google.com/file/d/1wvkhsr4xhku2cWlKzK-r0CtDMPvtDkFJ/view?usp=sharing) 
<br>
<!-- [Paper](https://drive.google.com/file/d/1lLixKTiuunU0tAJz38YPS9mW4sT7QqNr/view?usp=sharing) -->
[Paper](https://www.bcentral.cl/documents/33528/133326/dtbc883.pdf/ad65f9fd-c263-a5a5-ba2c-eb9af6c2c7ce?t=1595449144477)

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.align = 'center', out.width = '100%'}
path="D:/Trabajo/twitter/DEPUC/basededatos/"
depu<-read_excel(paste0(path,"DEPUC.xls"),2)
depu$week=stringi::stri_datetime_fields(depu$date)$WeekOfMonth
imacec<-read_excel(paste0(path,"DEPUC.xls"),"imacec")
depu <- merge(depu, imacec, by=c("anio", "mes","dia"), all=T)
```

<br>
<center>
<font size="4" color="black"><p style="text-align:center;">Daily Economic Policy Uncertainty Measures (\*)<br><font size="2" color="black"></font></p></font>
```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.align = 'center', out.width = '100%'}

fig1 <- plot_ly(depu, y =~depu_ma_30, x=~date, name = 'DEPU', type = 'scatter', mode="lines" ,line = list(color = "blue", width = 4), hoverinfo = 'text', text = ~paste('</br> date: ', format(date, "%d%b%Y"),
                      '</br> Valor: ', format(round(depu_ma_30, 2),nsmall=2)))  %>% add_trace(y = ~depuc_ma_30, x=~date, name = 'DEPUC', type="scatter", mode="lines", line = list(color = "orange", width = 4),hoverinfo = 'text', text = ~paste('</br> Fecha: ', format(date, "%d%b%Y"),'</br> Valor: ', format(round(depuc_ma_30,2),nsmall=2))) %>% layout(legend = list(orientation = "h", xanchor = "center", x = 0.5, y=1), xaxis = list(title = "", showgrid = F,  type="date", tickangle=0, showline = F, tick0="2012-01-01", dtick="M12",  tickformat="<br>%y",range=c("2011-11-01","2020-08-31"),rangeslider = list(type = "date")),yaxis = list(title = " ", side="left",range=c(-1,3),dtick=1,showgrid = F,zerolinecolor ="black", zerolinewidth = 1.5, zeroline = T, ticksuffix=" ", tickformat = ".1f"),                            shapes=list(list(type='line', x0= "2012-01-16", x1= "2012-01-16", y0=-1, y1=3, line  =list (dash='dot', width=4, color="gray"), opacity = 0.3),
list(type='line', x0= "2012-04-30", x1= "2012-05-05", y0=-1, y1=3, line=list(dash='dot', width=4, color="gray"), opacity = 0.3),
list(type='line', x0= "2013-06-30", x1= "2013-06-21", y0=-1, y1=3, line=list(dash='dot', width=4, color="gray"), opacity = 0.3),
list(type='line', x0= "2013-11-21", x1= "2013-11-21", y0=-1, y1=3, line=list(dash='dot', width=4, color="gray"), opacity = 0.3),
list(type='line', x0= "2014-05-14", x1= "2014-05-14", y0=-1, y1=3, line=list(dash='dot', width=4, color="gray"), opacity = 0.3),
list(type='line', x0= "2014-09-10", x1= "2014-09-10", y0=-1, y1=3, line=list(dash='dot', width=4, color="gray"), opacity = 0.3),
list(type='line', x0= "2017-12-31", x1= "2017-12-31", y0=-1, y1=3, line=list(dash='dot', width=4, color="gray"), opacity = 0.3),
list(type='line', x0= "2018-06-16", x1= "2018-06-16", y0=-1, y1=3,   line=list(dash='dot', width=4, color="gray"), opacity = 0.3),
list(type='line', x0= "2019-06-15", x1= "2019-06-15", y0=-1, y1=3, line=list(dash='dot', width=4, color="gray"), opacity = 0.3),
list(type='line', x0= "2020-01-22", x1= "2020-01-22", y0=-1, y1=3, line=list(dash='dot', width=4, color="gray"), opacity = 0.3),
list(type="rect", fillcolor="gray", line = list(color = "white"),x0="2019-10-20", x1="2020-01-01", y0=-1, y1=3, opacity=0.4, layer="below"),
list(type="rect", fillcolor="gray", line = list(color = "white"),x0="2020-03-10", x1="2020-06-26", y0=-1, y1=3, opacity=0.4, layer="below")), 
annotations = list(list(text = "European<br>debt crisis",  x = "2012-01-16", y = 0.7,showarrow=T, xanchor="left"),list( text="Tax reform proj.<br>announcement", x="2012-04-30", y=2, showarrow=T, xanchor="rigth"),list(text = "Primaries<br>elections",  x = "2013-06-30", y = 1.5,showarrow=T, xanchor="left"),list(text = "Runoff<br>elections",  x = "2013-11-21", y = 0.8,showarrow=T, xanchor="left"),list(text = "Tax reform<br>approval",  x = "2014-05-14", y = 1.5,showarrow=T, xanchor="left"),list(text = "Explosive attack<br>Santiago subway",  x = "2014-09-10", y = 1,showarrow=T, xanchor="left"),list(text = "Runoff<br>elections",  x = "2017-12-31", y = 0.5,showarrow=T, xanchor="left"),list(text = "China-US<br>trade war",  x = "2018-06-16", y = 1.2,showarrow=T, xanchor="left"),list(text = "CLP/USD<br>700",  x = "2019-06-15", y = 0.7,showarrow=T, xanchor="rigth")
,list(text = "O-18",  x = "2019-12-01", y = 1.1,showarrow=T, xanchor="rigth"),list(text = "Wuhan under<br>quarantine",  x = "2020-01-24", y = 1.6,showarrow=T, xanchor="rigth"),list(text = "",  x = "2020-07-1", y = 0.4,showarrow=T, xanchor="rigth", ax=0,ay =40),list(text = "<br>IMACEC",  x = "2020-05-25", y = 0.15,showarrow=T, xanchor="rigth", ax=0,ay =30),list(text = "10%",  x = "2020-07-08", y = 0.7,showarrow=T, xanchor="rigth"))) %>% config(modeBarButtonsToRemove = c("zoom2d", "pan2d", "select2d", "lasso2d", "zoomIn2d", "zoomOut2d", "autoScale2d", "resetScale2d", "hoverClosestCartesian", "hoverCompareCartesian", "zoom3d", "pan3d", "resetCameraDefault3d", "resetCameraLastSave3d", "hoverClosest3d", "orbitRotation", "tableRotation", "zoomInGeo", "zoomOutGeo", "resetGeo", "hoverClosestGeo", "sendDataToCloud", "hoverClosestGl2d", "hoverClosestPie", "toggleHover", "resetViews", "toggleSpikelines", "resetViewMapbox"),displaylogo = FALSE)
fig1
```
</center>
<font size="2"><p>(\*) Both series were filtered using a 30-days moving average to avoid excessive daily variability. Vertical lines mark events of substantial economic uncertainty, whereas shaded areas mark various events related to the civil protests and riots of October 2019 and the COVID-19 pandemic starting mid-March 2020 onwards.<br>
Source: Authors’ elaboration.</p></font>

<br>
<center>
<font size="4" color="black"><p style="text-align:center;">Daily Economic Policy Uncertainty Measures & IMACEC(\*)<br><font size="2" color="black"></font></p></font>
```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.align = 'center', out.width = '100%'}

fig1 <- plot_ly(depu, y =~depu_ma_30, x=~date, name = 'DEPU', type = 'scatter', mode="lines" ,line = list(color = "blue", width = 4), hoverinfo = 'text', text = ~paste('</br>Fecha: ', format(date, "%d%b%Y"), '</br> Valor: ', format(round(depu_ma_30, 2),nsmall=2)))  %>% add_trace(y = ~depuc_ma_30, x=~date, name = 'DEPUC', type="scatter", mode="lines", line = list(color = "orange", width = 4),hoverinfo = 'text', text = ~paste('</br> Fecha: ', format(date, "%d%b%Y"),'</br> Valor: ', format(round(depuc_ma_30,2),nsmall=2))) %>% add_trace(y = ~imacecv12, name = 'IMACEC (RA)', type="scatter", mode="markers", line = list(color = "green", width = 4), hoverinfo = 'text', text = ~paste('</br>Fecha: ', format(date, "%b%Y"), '</br> IMACEC: ', format(round(imacecv12, 2),nsmall=2)), yaxis="y2") %>% layout(legend = list(orientation = "h", xanchor = "center", x = 0.5, y=1), xaxis = list(title = "", showgrid = F,  type="date", tickangle=0, showline = F, tick0="2012-01-01", dtick="M12",  tickformat="<br>%y",range=c("2011-11-01","2020-07-31"),rangeslider = list(type = "date")),yaxis = list(title = " ", side="left",range=c(-3,3),dtick=1,showgrid = F,zerolinecolor ="black", zerolinewidth = 1.5, zeroline = T, ticksuffix=" ", tickformat = ".0f"), yaxis2 = list(title = " ", side="right",range=c(-18,18), dtick=6,showgrid = F,zerolinecolor ="black", zerolinewidth = 1.5, zeroline = T, tickformat = ".0f", overlaying = "y", automargin=T)) %>% config(modeBarButtonsToRemove = c("zoom2d", "pan2d", "select2d", "lasso2d", "zoomIn2d", "zoomOut2d", "autoScale2d", "resetScale2d", "hoverClosestCartesian", "hoverCompareCartesian", "zoom3d", "pan3d", "resetCameraDefault3d", "resetCameraLastSave3d", "hoverClosest3d", "orbitRotation", "tableRotation", "zoomInGeo", "zoomOutGeo", "resetGeo", "hoverClosestGeo", "sendDataToCloud", "hoverClosestGl2d", "hoverClosestPie", "toggleHover", "resetViews", "toggleSpikelines", "resetViewMapbox"),displaylogo = FALSE) 

fig1
```
</center>
<font size="2"><p>(\*) DEPU & DEPUC series were filtered using a 30-days moving average to avoid excessive daily variability. <br>
(\*) IMACEC montly and right axis.<br>
Source: Authors’ elaboration.</p></font>

